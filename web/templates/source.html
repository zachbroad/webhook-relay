{{define "content"}}
<div class="breadcrumb"><a href="/sources">Sources</a> / {{.Source.Name}}</div>
<div class="header-row">
  <h1>{{.Source.Name}}</h1>
  <button class="btn btn-danger btn-sm"
    hx-delete="/sources/{{.Source.Slug}}"
    hx-confirm="Delete this source and all its subscriptions?">Delete Source</button>
</div>
<div class="card">
  <dl class="meta-grid">
    <dt>ID</dt><dd><code>{{.Source.ID}}</code></dd>
    <dt>Slug</dt><dd><code>{{.Source.Slug}}</code></dd>
    <dt>Webhook URL</dt><dd><code>{{.WebhookURL}}</code></dd>
    <dt>Created</dt><dd>{{formatTime .Source.CreatedAt}}</dd>
    <dt>Updated</dt><dd>{{formatTime .Source.UpdatedAt}}</dd>
  </dl>
  <h2>Edit Name</h2>
  <form action="/sources/{{.Source.Slug}}/update" method="POST" class="form-inline">
    <input type="text" name="name" value="{{.Source.Name}}" style="flex:1;min-width:200px" required>
    <button type="submit" class="btn btn-primary btn-sm">Update</button>
  </form>
</div>
{{template "subscriptions-card" .}}
{{end}}

{{define "subscriptions-card"}}
<div class="card" id="subscriptions-card">
  <h2>Subscriptions</h2>
  <form hx-post="/sources/{{.Source.Slug}}/subscriptions"
        hx-target="#subscriptions-card"
        hx-swap="outerHTML"
        class="form-inline">
    <input type="url" name="target_url" placeholder="https://example.com/webhook" style="flex:1;min-width:250px" required>
    <input type="text" name="signing_secret" placeholder="Signing secret (optional)" style="width:200px">
    <button type="submit" class="btn btn-primary">Add</button>
  </form>
  {{if .Subscriptions}}
  <table>
    <thead><tr><th>Target URL</th><th>Active</th><th>Created</th><th></th></tr></thead>
    <tbody>
      {{range .Subscriptions}}
      <tr>
        <td><code>{{.TargetURL}}</code></td>
        <td>
          <label class="toggle">
            <input type="checkbox" name="is_active" {{if .IsActive}}checked{{end}}
              hx-post="/sources/{{$.Source.Slug}}/subscriptions/{{.ID}}/toggle"
              hx-target="#subscriptions-card"
              hx-swap="outerHTML">
            <span class="slider"></span>
          </label>
        </td>
        <td>{{formatTime .CreatedAt}}</td>
        <td>
          <button class="btn btn-danger btn-sm"
            hx-delete="/sources/{{$.Source.Slug}}/subscriptions/{{.ID}}"
            hx-confirm="Delete this subscription?"
            hx-target="#subscriptions-card"
            hx-swap="outerHTML">Delete</button>
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
  {{else}}
  <div class="empty">No subscriptions yet.</div>
  {{end}}
</div>
{{end}}
